# 要件定義 v0.1

## 概要
- 目的: マイクからの音声を文字起こしし、議事録を生成。リアルタイム字幕表示と録音後の要約を提供。多言語の同時通訳・翻訳にも対応。
- 対象ユーザ: 個人利用、クライアント共有。
- プラットフォーム: Next.js（スマートフォン優先/PWA想定）。データはローカル保存。出力はMarkdownで端末にダウンロード。

## 入力・収音
- 音源: PCマイク/外部マイク/スマートフォンのマイク。
- 取り込み形態: リアルタイム録音＋既存音声ファイル（mp3/wav/m4a等）取り込みの双方に対応。
- オンライン会議音取り込み: PCは「タブ音声＋マイク」のみ対応。アプリ全体のシステム音収録は非対応。モバイルはマイクのみ。
- ノイズ環境: ノイズ除去あり（WebRTC AudioProcessing/RNNoise等）。
- 録音時間上限: TBD（暫定で数時間規模を想定）。

## 文字起こし（STT）要件
- 精度目標: 誤り5%以内（WER≦5%）を目安。
- レイテンシ: リアルタイム字幕は最初の暫定テキストまで2秒以内。翻訳字幕は最大3秒以内。
- 話者分離: 必要（MVPは簡易A/Bクラスタリング＋手動修正）。
- 句読点/整形: 句読点自動挿入、改行整形、フィラ（えー/あー等）除去。
- 辞書: 専門用語辞書/固有名詞を.mdまたは.pdfで設定可能（事後補正/プロンプト注入/ファジー置換で対応）。MVPでは`用語 => 正しい表記` 形式のマッピング適用に対応。
- オン/オフ切替: Whisper系APIへの送信はユーザーが明示許容し、設定でON/OFF切替（OFF時はローカル録音のみ）。

## 議事録生成
- 要約・抽出: 決定事項/論点/結論/次アクション/期限/担当を抽出。
- 出力: Markdown（タイムスタンプ/セクション分割/音声引用リンクはユーザーが選択可能）。
- 翻訳: 多言語版要約/同時通訳字幕/TL;DRに対応。
  - 実装: LLMチャットAPIを利用（Groq/OpenAI）。Next.js Route Handler でプロキシし、ユーザーのAPIキーを転送のみ。クラウド保存は行わない。
  - 要約出力: 指定した項目に対応する見出し（##）で必ず区切り、箇条書きで記述。次アクションは可能な限り担当者/期限を含む。
  - 辞書UI: 取り込んだ辞書は先頭20件のプレビューを表示し、適用/クリアが可能。

## UI/編集
- 表示: ライブ字幕表示（2秒以内）、翻訳字幕（～3秒）。
- 編集: テキスト修正、話者名編集、ハイライト、コメント、変更履歴（簡易）。
- 同時編集: 選択可能要件だが、MVPでは非対応（単独編集のみ）。
- アクセシビリティ: 字幕サイズ/配色/ショートカット等を変更可能。

## 連携・出力
- 外部連携: なし（カレンダー/Slack/Zoom/Drive等は当面非対応）。
- 形式: Markdownのみ。生成物は端末にダウンロード。

## セキュリティ・プライバシー
- データ保管: ローカルのみ（クラウド永続化なし）。
- 削除: ユーザー自身が削除操作を実施。
- APIキー: 端末にのみ保存（例: 暗号化してlocalStorage/IndexedDB）。
- 例外: STT/LLM API利用時は音声/テキストがAPI提供者へ送信される。ユーザーが設定で明示許容。

## 非機能要件
- 想定処理量: 約3時間/人・日。
- SLO/SLA/RPO/RTO: 未設定（MVP後に実測して設定）。
- オフライン動作: 録音/編集/保存は可。STT/要約/翻訳はオンライン時のみ。

## 運用・コスト/モデル選択
- APIキー: 設定メニューでユーザーが設定。
- 優先モデル: Groq API（whisper-large-v3 を試行）。無料枠枯渇時はOpenAIのWhisperへフォールバック。
- 監視/ログ: 特に要件なし（ローカルで最小限）。

## 受入基準（MVP）
- 録音開始ボタンで1–2秒ごとに文字起こしが反映される（初回2秒以内）。
- 翻訳字幕が3秒以内で表示される。
- 簡易話者分離（話者A/B）と手動修正が可能。
- フィラ除去と基本の句読点整形が行われる。
- 既存音声ファイル（mp3/wav/m4a）を取り込み、全文文字起こしできる。
  - 実装: ブラウザでファイル選択→STT（Groq/OpenAI）へ送信→文単位でセグメント化して現在の議事録に追加。
- 「要約」ボタンで決定事項/論点/次アクション/期限/担当のMarkdownを生成。
- 用語辞書（.md/.pdf）を読み込み、出力に反映（候補提示/置換）。
- 生成結果をMarkdownでダウンロードできる。
- データとAPIキーは端末内にのみ保存される。STT送信は設定でON/OFF可能。

## リスク・制約
- ブラウザでのシステム音収録は「タブ音声」に限定。アプリ全体の音は不可（OS制約）。モバイルはマイクのみ。
- WER≦5%はマイク品質/環境/話者分離の影響を受ける。環境により満たせない可能性。
- 話者分離の精度と低遅延はトレードオフ。MVPは簡易実装＋手動補正。
- 完全ローカルSTTはMVP範囲外（将来対応候補）。

## 今後の検討（ポストMVP）
- 高精度話者分離（埋め込みモデル/再学習/話者名自動割当）。
- 同時編集（P2P/WebRTC or 軽量BaaS）とレビュー承認フロー。
- ローカル推論（オンデバイスWhisper小型版）オプション。
- 実測に基づくSLO策定、品質モニタリング。
